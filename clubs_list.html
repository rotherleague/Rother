<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <title>Clubs</title>
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <style>
    .list-group-item.active {
      background-color: #1d2071;
      border-color: #1d2071;
    }
    #navbar-clubs.affix-top, #navbar-clubs.affix {
      position: fixed;
      top: 50px;
      right: 0;
      width: 100%;
    }
    #navbar-clubs.affix-bottom {
      position: relative;
      top: 50px;
      right: 0;
      width: 100%;
    }
    .table-of-contents {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <section class="article" id="list">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12 col-md-8">
          <div class="row align-items-start">
            <section class="col-sm-8" data-spy="scroll" data-target="#navbar-clubs">
              <h2>Clubs</h2>
              <div id="table-of-contents" class="table-of-contents"></div>
              <div id="clubs" class="list-group"></div>
            </section>
            <nav id="navbar-clubs" class="col-sm-4 nav">
              <ul id="nav" class="list-group list-group-flush"></ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </section>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <script src="https://rawgit.com/bassjobsen/affix/master/assets/js/affix.js"></script>
  <script>
    $('#navbar-clubs').affix({
      offset: { top: 25, bottom: 50 }
    });

    var clubs_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR4VY_mJjSYwTf7n1xBWtsqvo3x4RIXErc4fhel4TRyEcAtG78pfsAfrLWTrXXTzigUJvT7nDUDWg0E/pubhtml';

    function init() {
      Papa.parse(clubs_spreadsheet_url, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function (clubsResults) {
          showInfo(clubsResults);
        }
      });
    }

    window.addEventListener('DOMContentLoaded', init);

    function showInfo(clubsResults) {
      var clubsData = clubsResults.data.slice(1); // Skip the second row of the club data
      var $nav = $('#nav');
      var $clubs = $('#clubs');
      var $toc = $('#table-of-contents');
      var cat = '';
      var content_li = '';

      $.each(clubsData, function (i, club) {
        if (club['Name Of Club'] !== 'Name Of Club') {
          var clubName = titleCase(club['Name Of Club']);
          var anchorName = clubName.replace(/\s/g, '_');

          // Add to navigation
          var nav_li = $('<div></div>');
          var navlist_li = '<a href="#ref' + anchorName + '" class="nav-link">' + clubName + '</a>';
          nav_li.append('<li class="list-group-item p-0">' + navlist_li + '</li>');
          nav_li.appendTo($nav);

          // Add to Table of Contents
          var toc_li = '<li><a href="#ref' + anchorName + '">' + clubName + '</a></li>';
          $toc.append('<ul>' + toc_li + '</ul>');

          // Add club details
          if (cat !== club['Name Of Club']) {
            var cat_li = '<br><div class="list-group-item list-group-item-action active" id="ref' + anchorName + '">' +
              '<div class="d-flex w-100 justify-content-between">' +
              '<h1>' + clubName + '</h1>' +
              '</div>' +
              '</div>';
            content_li += cat_li;
          }

          content_li += '<strong>Club Secretary:</strong> ' + club['First Name'] + ' ' + club['Surname'] + '<br>';
          if (club['Visible'].toLowerCase() === 'show') {
            if (club['Mobile']) {
              content_li += '<strong>Tel:</strong> <a href="tel:' + club['Mobile'].replace(/\s/g, '') + '">' + club['Mobile'] + '</a><br>';
            }
            if (club['Email']) {
              content_li += '<strong>Email:</strong> <a href="mailto:' + club['Email'] + '">' + club['Email'] + '</a><br>';
            }
          }

          var list_li = $('<div></div>');
          list_li.append('<div class="list-group-item list-group-item-action"><div class="d-flex w-100 justify-content-between"><h5 class="mb-1">' + clubName + '</h5></div>' + content_li + '</div>');
          list_li.prepend(cat_li);
          list_li.appendTo($clubs);

          cat = club['Name Of Club'];
          content_li = '';
        }
      });
    }

    function titleCase(str) {
      return str.toLowerCase().split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
    }
  </script>
</body>
</html>
